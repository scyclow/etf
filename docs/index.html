<!--

TODO
  - popup at beginning of site
  - Are you
    - An Individual Investor
    - An Authorized Participant





 -->



<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ETF</title>
  <link rel="shortcut icon" type="image/x-icon" href="./assets/etf.png" id="favicon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="ETF seeks to simulate the experience of owning shares of an exchange-traded fund that seeks to reflect, before fees and expenses, the performance of the price of Ethereum.">
  <meta name="keywords" content="steviep, steve pikelny, pikelny, crypto, ethereum, etf, bitcoin, erc20, memecoin, shitcoin, exchange-traded fund">

  <meta name="twitter:image" content="https://steviep.xyz/etf/assets/etf.png">
  <meta name="twitter:image:alt" content="ETF">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@steviepxyz">
  <meta name="twitter:site" content="@steviepxyz">
  <meta property="twitter:description" content="ETF seeks to simulate the experience of owning shares of an exchange-traded fund that seeks to reflect, before fees and expenses, the performance of the price of Ethereum.">

  <meta name="og:image" property="og:image" content="https://steviep.xyz/etf/assets/etf.png">
  <meta name="og:image:alt" content="ETF">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://steviep.xyz/etf">
  <meta property="og:title" content="ETF">
  <meta property="og:site_name" content="ETF">
  <meta property="og:description" content="ETF seeks to simulate the experience of owning shares of an exchange-traded fund that seeks to reflect, before fees and expenses, the performance of the price of Ethereum.">


  <link rel="stylesheet" type="text/css" href="./styles.css">

  <style type="text/css">




  .cta {
    height: 6em;
    display: flex;
    align-items: center;
    justify-content: space-around;
    flex-direction: column;
  }



  .apGrid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    justify-items: center;
  }

  .apItem {
    margin-bottom: 1em;
  }
  .apOwner {
    font-family: monospace;
    color: var(--accent-color);
    text-decoration: underline;
  }
  .apOwner:hover {
    text-decoration: none;

  }

  #timeLeft {
    margin-left: 0.5em;
    font-family: monospace;
    font-size: 1.25em;
  }




  @media(max-width: 820px) {
    .apGrid {
      grid-template-columns: 1fr 1fr;
    }
  }


  @media(max-width: 540px) {
    .apGrid {
      grid-template-columns: 1fr;
    }
  }



  </style>


  <script src="./utils.js"></script>
  <script type="module" src="./connectWallet.js"></script>




</head>
<body>
  <header>
    <div>
      <h1>ETF</h1>
      <div class="headerPattern">
        <div style="width: 100%"></div>
        <div style="width: 80%"></div>
        <div style="width: 60%"></div>
        <div style="width: 40%"></div>
        <div style="width: 20%"></div>
      </div>
      <div class="cta">
        <a href="#facts">Fund Facts →</a>
        <a href="#ap">Liquidity →</a>
        <!-- <a href="#facts">Terms →</a> -->
        <connect-wallet>
          <div slot="notConnected" class="connectItem">
            <connect-button>
              <button id="connectButton" slot="button">Connect</button>
              <div slot="loading">Loading...</div>
            </connect-button>
          </div>
        </connect-wallet>
      </div>
    </div>
    <div style="display: block; text-align: center; margin-top: 1em; letter-spacing: 0.3em;">Trading Hours: M-F | 9:30AM-4:00PM [EST]</div>


    <div style="display: flex; justify-content: center; margin-top: 0.5em;">
      <div id="marketChange"></div><div id="timeLeft"></div>
    </div>
  </header>

  <main>
    <section id=facts>

      <section>
        <dl>
          <div>
            <dt>Ticker</dt>
            <dd>$ETF</dd>
          </div>

          <div>
            <dt>Net Asset Value</dt>
            <dd>0.0001 ETH</dd>
          </div>

          <div>
            <dt>Authorized Participants</dt>
            <dd>6</dd>
          </div>

          <div>
            <dt>Inception Date</dt>
            <dd>TBD</dd>
          </div>
        </dl>

        <connect-wallet>
          <div slot="notConnected" class="connectItem">
            <dl>
              <div>
                <dt>Benchmark</dt>
                <dd>Ethereum</dd>
              </div>

              <div>
                <dt>Sector</dt>
                <dd>Cryptocurrency</dd>
              </div>

              <div>
                <dt>Gross Expense Ratio</dt>
                <dd>0.00%</dd>
              </div>

              <div>
                <dt>30-Day SEC Yield</dt>
                <dd>0.00%</dd>
              </div>
            </dl>

            <em style="text-align:center; display: block; margin-bottom: 0.25em">Connect wallet for more info</em>
          </div>

          <div slot="connected">
            <dl>
              <div>
                <dt>Premium/Discount (bps)</dt>
                <dd>N/A</dd>
              </div>

              <div>
                <dt>Market Price</dt>
                <dd>N/A</dd>
              </div>

              <div>
                <dt>Shares Outstanding</dt>
                <dd id="sharesOutstanding">0.0000</dd>
              </div>

              <div>
                <dt>Assets Under Management (AUM)</dt>
                <dd id="aum">0.0000</dd>
              </div>
            </dl>

            <dl>
              <div>
                <dt>Benchmark</dt>
                <dd>Ethereum</dd>
              </div>

              <div>
                <dt>Sector</dt>
                <dd>Cryptocurrency</dd>
              </div>

              <div>
                <dt>Gross Expense Ratio</dt>
                <dd>0.00%</dd>
              </div>

              <div>
                <dt>30-Day SEC Yield</dt>
                <dd>0.00%</dd>
              </div>
            </dl>
          </div>
        </connect-wallet>
      </section>

      <section>
        <div style="margin-top: 1em; display: flex; justify-content: space-around;">
          <div style="display: inline-block;">
            <h2>Sector Breakdown</h2>
            <div style="width: 200px; margin: 0.75em auto; ">
              <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                <circle cx="250" cy="250" r="250" fill="var(--accent-color)"></circle>
                <text font-size="30px" x="50%" y="40%" dominant-baseline="middle" text-anchor="middle" fill="var(--bg-color)">Cryptocurrency: 100%</text>
                <line stroke="var(--bg-color)" x1="250" y1="250" x2="500" y2="250"></line>
              </svg>
            </div>
          </div>

          <div style="display: inline-block;">
            <h2>Top 10 Holdings</h2>
            <div style="width: 200px; margin: 0.75em auto;">
              <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                <circle cx="250" cy="250" r="250" fill="var(--accent-color)"></circle>
                <text font-size="30px" x="50%" y="40%" dominant-baseline="middle" text-anchor="middle" fill="var(--bg-color)">Ether: 100%</text>
                <line stroke="var(--bg-color)" x1="250" y1="250" x2="500" y2="250"></line>
              </svg>
            </div>
          </div>
        </div>
      </section>

      <div style="margin-top: 1em">
        <h3>Overview</h3>
        <p>ETF seeks to simulate the experience of owning shares of an exchange-traded fund that seeks to reflect, before fees and expenses, the performance of the price of Ethereum.</p>

        <p>All shares are standard ERC-20 tokens that may only be traded during market trading hours of Monday through Friday, 9:30am to 4:00pm Eastern Standard Time. Market holidays are not recognized. Shares of ETF may only be created and redeemed by the owners of Authorized Participants (APs) Non Fungible Tokens (NFTs).</p>

        <p>ETF is not an investment company registered under the Investment Company Act of 1940, and therefore is not subject to the same regulatory requirements as mutual funds or ETFs registered under the Investment Company Act of 1940. ETF is not a commodity pool for purposes of the Commodity Exchange Act. Before making an investment decision, you should carefully consider the risk factors associated with owning cryptocurrency, and consult your financial advisor. Past performance does not guarantee future results.</p>
      </div>

    </section>

    <section id="ap">
      <h2>Authorized Participants (AP)</h2>
      <p>Authorized Participants have the sole right (but not the obligation) to create and redeem shares of ETF. APs may only create shares by delivering a "creation basket" of Ether in the ratio of 1ETH:10000ETF (or 0.0001ETH:1ETF) to the AP smart contract. Similarly, they may only redeem shares by delivering a "redemption basket" of ETF to the AP smart contract in the same ratio. This functions to provide crucial liquidity to the market for ETF. Whenever shares of ETF begin trading at a premium on the secondary market (i.e. above the NAV of 0.0001 ETH per share), APs can provide liquidity by creating and selling new shares. In doing so, they take advantage of an arbitrage opportunity. Alternatively, whenever shares of ETF trade at a discount (i.e. below the NAV of 0.0001 ETH per share), APs can purchase shares on the secondary market and redeem them to take advantage of the same arbitrage opportunity.</p>


      <div class="apGrid">
        <div id="ap1" class="apItem">
          <a href="./ap/1"><img src="./assets/ap1.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap1-display"></div>
            </div>
          </connect-wallet>
        </div>
        <div id="ap2" class="apItem">
          <a href="./ap/2"><img src="./assets/ap2.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap2-display"></div>
            </div>
          </connect-wallet>
        </div>
        <div id="ap3" class="apItem">
          <a href="./ap/3"><img src="./assets/ap3.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap3-display"></div>
            </div>
          </connect-wallet>
        </div>
        <div id="ap4" class="apItem">
          <a href="./ap/4"><img src="./assets/ap4.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap4-display"></div>
            </div>
          </connect-wallet>
        </div>
        <div id="ap5" class="apItem">
          <a href="./ap/5"><img src="./assets/ap5.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap5-display"></div>
            </div>
          </connect-wallet>
        </div>
        <div id="ap6" class="apItem">
          <a href="./ap/6"><img src="./assets/ap6.svg"></a>
          <connect-wallet>
            <div slot="connected" style="margin-top: 0.5em">
              <div id="ap6-display"></div>
            </div>
          </connect-wallet>
        </div>
        <a href="./ap/5"><img src="./assets/tl.svg"></a>
      </div>
    </section>

    <section>
      <h3><a href="https://etherscan" style="color:var(--accent-color); text-decoration: underline;">ETF Contract</a></h3>
      <h3><a href="https://etherscan" style="color:var(--accent-color); text-decoration: underline;">Authorized Participant Contract</a></h3>
    </section>
  </main>

  <footer>
    <h4>Risk Disclosure</h4>

    <p>ETF is not an investment company registered under the Investment Company Act of 1940, and therefore is not subject to the same regulatory requirements as mutual funds, ETFs, or other exchange-traded products registered under the Investment Company Act of 1940. Before making a financial decision, you should carefully consider the risk factors associated with owning cryptocurrency, and consult your financial advisor. Past performance does not guarantee future results.</p>

    <p>Furthermore, purchasing shares of ETF does not constitute an investment contract, and shares of ETF do not constitute financial securities. Owners of ETF have no reasonable expectaiton of profit, as Authorized Participants are expected to arbitrage any differences between ETF market price and net asset value. Additionally, Authorized Participant NFTs do not constitute financial securities, as any profits derived from ownership of said tokens would be due soley to the efforts of the token owner, rather than the entrepreneurial efforts of others.</p>

    <p>All smart contracts developed by Steve Pikelny, including the ETF and Authorized Participant contracts, are provided "as is," without warranty of any kind, express or implied, including but not limited to the warranties of merchantability, fitness for a particular purpose, and non-infringement. The developer makes no warranty that the Software will be error-free, uninterrupted, or free of defects. The developer shall not be responsible for any financial loss incurred by the user as a result of using the Software. This includes but is not limited to losses resulting from investment decisions, trading activities, software bugs, or any other financial transactions conducted using the Software.</p>

    <p>Investing in digital assets, such as Ether and elaborate DeFi-inspired memecoins, involves significant risk due to their extreme price volatility and the potential for loss, theft, or compromised private keys. The value of shares is closely tied to acceptance, industry developments, and governance changes, making them highly susceptible to market sentimant. Digital assets represent a new and rapidly evolving industry, and the value of Shares depends on the acceptance of Ethereum. Changes in the governance of a digital asset network may not receive sufficient support from users or stakers, which may negatively affect that digital asset network's ability to grow and respond to challenges. Infesting in ETF comest with risks that could impact ETF's share value, including large-scale sales by major holders, security threats like breaching or hacking, negative sentiment among speculators, and competition from central bank digital currencies and financial initiatives using blockchain technology. A disruption of the internet or a digital asset network, such as the Ethereum network, would affect the ability to transfer digital assets, including Ether and ETF, and would consequently impact their value. There can be no assurance that the smart contracts holding ETF's assets are free of defects, will actually work as designed, or prove to be successful in safeguarding ETFs assets against all possible sources of theft, loss, or damage.</p>

    <div style="text-align:center; font-size: 2em; font-style: normal; margin: 2em;"><a href="https://steviep.xyz" target="_blank" style="color: var(--accent-color); text-decoration: underline;">steviep.xyz</a> (c) 2024</div>
</footer>
</body>


<script src="./contracts.js"></script>
<script type="module">

  import {$} from './$.js'
  import {provider, bnToN, ZERO_ADDR} from './eth.js'


  provider.setContractInfo(CONTRACTS)


  const apToAuctionId = {
    0: 0,
    1: 1,
    2: 2,
    3: 3,
    4: 4,
    5: 5,
  }

  let ETF, AP, AUCTION
  provider.onConnect(async (addr) => {

    try {

      ({ ETF, AP, AUCTION } = await provider.getContracts())
      console.log(AUCTION)

      $.id('aum').innerHTML = fromWei(await provider.getETHBalance(ETF.address)).toFixed(4) + ' ETH'
      $.id('sharesOutstanding').innerHTML = fromWei(await ETF.totalSupply()).toFixed(4)

      times(6, async _i => {
        const i = _i + 1
        const ownerAddr = await AP.ownerOf(i)

        if (ownerAddr === AUCTION.address) {
          const [
            highestBid,
            auction,
            auctionEndTime,
            isActive
          ] = await Promise.all([
            AUCTION.auctionIdToHighestBid(apToAuctionId[i]),
            AUCTION.auctionIdToAuction(apToAuctionId[i]),
            AUCTION.auctionEndTime(apToAuctionId[i]),
            AUCTION.isActive(apToAuctionId[i]),
          ])

          const bidderDisplay = highestBid.bidder === ZERO_ADDR
            ? '-'
            : `<a href="https://etherscan.io/address/${highestBid.bidder}" class="apOwner" target="_blank" rel="nofollow">${await provider.formatAddr(highestBid.bidder)}</a></dd>`

          $.id(`ap${i}-display`).innerHTML = `
            <div style="display:flex;justify-content:center;margin-bottom:1em"><a class="apOwner" href="./ap/${i}">Make Bid →</a></div>
            <div>
              <dt>Highest Bidder</dt>
              <dd>${bidderDisplay}</dd>
            </div>
            <div>
              <dt>Highest Bid</dt>
              <dd>${fromWei(highestBid.amount)} ETH</dd>
            </div>
            <div>
              <dt>Time Left</dt>
              <dd id="ap${i}-timer">-</dd>
            </div>
          `

          if (isActive && bnToN(highestBid.timestamp)) triggerTimer(bnToN(auctionEndTime) * 1000 - Date.now(), $.id(`ap${i}-timer`))

        } else {
          $.id(`ap${i}-display`).innerHTML = `

            <div style="display:flex;justify-content:center;margin-bottom:1em"><a class="apOwner" href="./ap/${i}">More Info →</a></div>
            <div>
              <dt>Owned By</dt>
              <dd><a href="https://etherscan.io/address/${ownerAddr}" class="apOwner" target="_blank" rel="nofollow">${await provider.formatAddr(ownerAddr)}</a></dd>
            </div>
            <div>
              <dt>Shares Created</dt>
              <dd>${fromWei(await ETF.created(i)).toFixed(4)}</dd>
            </div>
            <div>
              <dt>Shares Redeemed</dt>
              <dd>${fromWei(await ETF.redeemed(i)).toFixed(4)}</dd>
            </div>
          `
        }
      })
    } catch (e) {
      console.error(e)
    }


  })








  const $timeLeft = $.id('timeLeft')
  const $marketChange = $.id('marketChange')

  function getNextTimestamp() {
    const currentTimestamp = Date.now();
    const currentDate = new Date(currentTimestamp);
    const currentDay = currentDate.getUTCDay();
    const currentHour = currentDate.getUTCHours();
    const currentMinutes = currentDate.getUTCMinutes();

    // Check if it's Sunday, Monday, Tuesday, Wednesday, or Thursday after 9:00 PM UTC
    if (currentDay >= 0 && currentDay <= 4 && currentHour >= 21) {
      // Return UTC timestamp for 2 PM the next day
      const nextDayTimestamp = currentTimestamp + (24 * 60 * 60 * 1000); // Add 1 day
      const nextDay = new Date(nextDayTimestamp);
      nextDay.setUTCHours(14, 30, 0, 0); // Set time to 2:30 PM UTC
      return nextDay.getTime();
    }

    // Check if it's Friday after 9:00 PM UTC, Saturday, or Sunday
    if (
      (currentDay === 5 && currentHour > 21)
      || currentDay === 6 || currentDay === 0)
    {
      // Return UTC timestamp for the coming Monday at 1:30 PM
      const nextMondayTimestamp = currentTimestamp + ((8 - currentDay) % 7) * 24 * 60 * 60 * 1000; // Add days until Monday
      const nextMonday = new Date(nextMondayTimestamp);
      nextMonday.setUTCHours(14, 30, 0, 0); // Set time to 2:30 PM UTC
      return nextMonday.getTime();
    }


    if (currentDay > 0 && currentDay < 6 && (currentHour < 14 || (currentHour === 14 && currentMinutes < 30))) {
      currentDate.setUTCHours(14, 30, 0, 0);
      return currentDate.getTime();
    }

    currentDate.setUTCHours(21, 0, 0, 0);
    return currentDate.getTime();
  }


  function isMarketOpen() {
    const currentTimestamp = Date.now();
    const currentDate = new Date(currentTimestamp);
    const currentDay = currentDate.getUTCDay();
    const currentHour = currentDate.getUTCHours();
    const currentMinutes = currentDate.getUTCMinutes();

    return currentDay > 0 && currentDay < 6 && (currentHour > 13 || currentHour === 13 && currentMinutes >= 30) && currentHour < 20
  }


  function setRunInterval(fn, ms, i=0) {
    const run = () => {
      fn(i)
      i++
    }

    run()

    let isCleared = false

    let interval = setInterval(run, ms)

    const newInterval = (ms) => {
      if (isCleared) return
      clearInterval(interval)
      interval = setInterval(run, ms)
    }

    const stopInterval = () => {
      if (!isCleared) {
        clearInterval(interval)
        isCleared = true
      }
    }
    return stopInterval
  }



  function triggerTimer(timeLeft, $elem1, cb) {
    const with0 = x => x < 10 ? '0' + Math.floor(x) : Math.floor(x)
    let timeLeftCounter = timeLeft
    return setRunInterval(() => {
      timeLeftCounter = Math.max(timeLeftCounter - 1000, 0)
      const days = timeLeftCounter / (24*60*60*1000)
      const hours = 24 * (days%1)
      const minutes = 60 * (hours%1)
      const seconds = Math.floor(60 * (minutes%1))


      $elem1.innerHTML = `${Math.floor(days)}:${with0(hours)}:${with0(minutes)}:${with0(seconds)}`

      if (timeLeftCounter <= 0) {
        timeLeftCounter = getNextTimestamp() - Date.now()
      }

      if (cb) cb()

    }, 1000)
  }

  triggerTimer(getNextTimestamp() - Date.now(), $timeLeft, () => {
    if (isMarketOpen()) {
       $marketChange.innerHTML = 'Market Closes in:'
    } else {
       $marketChange.innerHTML = 'Market Opens in:'
    }
  })

</script>
</html>